#!/bin/bash

# QT-CI Project
# License: Apache-2.0
# https://github.com/benlau/qtci

set -e

if [ $# -lt 1 ]
then
    echo run-unittests pro
    exit -1
fi

PRO=$1

SRCDIR=`dirname $PRO`

if [ -f $SRCDIR/qpm.json ]
then
    (cd $SRCDIR;qpm install)
fi

TARGET=`cat $PRO | grep "TARGET *=" | sed "s/^TARGET *= *//"`

echo "Target executable: $TARGET"

qmake CONFIG+=debug $PRO
if [ -z "${QT_CI_SILENT}" ]
then
    make
else
    echo "Compiling..."
    make > /dev/null
fi
echo "Build Completed"

QT_QPA_PLATFORM=minimal ./$TARGET
